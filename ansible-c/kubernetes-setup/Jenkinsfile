pipeline {
    agent any

    options {
        disableConcurrentBuilds()
    }

    environment {
        pass = credentials('ansible')
        PLAY_PATH = "${WORKSPACE}/ansible-c/kubernetes-setup" 
    }
    stages {
        stage('display variable') {
            steps {
                display()
            }
        }
        stage('deploy kubernetes cluster') {
            steps {
                deploy()
            }
        }
      }
}

// display

def display() {
    sh 'echo ${PLAY_PATH}'
}

// deploy

def deploy() {
    sh 'ansible-playbook -i ${PLAY_PATH}/hosts ${PLAY_PATH}/k8s-setup.yaml \
        -u ansible --private-key=/home/ansible/.ssh/id_rsa'
}